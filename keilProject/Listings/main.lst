C51 COMPILER V9.54   MAIN                                                                  12/29/2025 13:45:37 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\IC_and_FPGA\MCU\stm32\Program\C51\BIN\C51.EXE ..\Codes\main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJ
                    -ECTEXTEND PRINT(.\Listings\main.lst) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <REGX52.H>
   2          #include "LCD1602.h"
   3          #include "DS18B20.h"
   4          #include "Delay.h"
   5          #include "UART.h"
   6          #include "Fan.h"
   7          
   8          
   9          float T;
  10          char Sign;
  11          
  12          void main()
  13          {
  14   1              DS18B20_ConvertT(); // 上电先转换一次温度，防止第一次读数据错误
  15   1              Delay(1000);            // 等待转换完成
  16   1              LCD_Init();
  17   1              LCD_ShowString(1, 1, "Temperature:");
  18   1              UART_Init();
  19   1              UART_SendString("Temperature:\r\n");
  20   1              // 初始化风扇模块
  21   1              Fan_Init();
  22   1              Fan_SetLevel(0);
  23   1              while (1)
  24   1              {
  25   2                      DS18B20_ConvertT();      // 转换温度
  26   2                      T = DS18B20_ReadT(); // 读取温度
  27   2                      if (T < 0)                       // 如果温度小于0
  28   2                      {
  29   3                              LCD_ShowChar(2, 1, '-');
  30   3                              Sign = '-';
  31   3                              T = -T;
  32   3                      }
  33   2                      else // 如果温度大于等于0
  34   2                      {
  35   3                              LCD_ShowChar(2, 1, '+');
  36   3                              Sign = '+';
  37   3                      }
  38   2                      LCD_ShowNum(2, 2, T, 3);                                                                  // 显示温度整数部分
  39   2                      LCD_ShowChar(2, 5, '.');                                                                  // 显示小数点
  40   2                      LCD_ShowNum(2, 6, (unsigned long)(T * 10000) % 10000, 4); // 显示温度小数部分
  41   2                      // 显示单位：°C（HD44780度符号代码0xDF）
  42   2                      LCD_ShowChar(2, 10, (char)0xDF);
  43   2                      LCD_ShowChar(2, 11, 'C');
  44   2      
  45   2                      UART_SendByte(Sign);
  46   2                      {
  47   3                              unsigned int intPart = (unsigned int)T;
  48   3                              UART_SendByte(intPart / 100 % 10 + '0');
  49   3                              UART_SendByte(intPart / 10 % 10 + '0');
  50   3                              UART_SendByte(intPart % 10 + '0');
  51   3                      }
  52   2                      UART_SendByte('.');
  53   2                      {
  54   3                              unsigned int frac = (unsigned long)(T * 10000) % 10000;
C51 COMPILER V9.54   MAIN                                                                  12/29/2025 13:45:37 PAGE 2   

  55   3                              UART_SendByte(frac / 1000 % 10 + '0');
  56   3                              UART_SendByte(frac / 100 % 10 + '0');
  57   3                              UART_SendByte(frac / 10 % 10 + '0');
  58   3                              UART_SendByte(frac % 10 + '0');
  59   3                      }
  60   2      
  61   2                      UART_SendByte(0xA1); // GBK 编码的高八位
  62   2                      UART_SendByte(0xE3); // GBK 编码的低八位
  63   2                      UART_SendByte('C');
  64   2      
  65   2                      // 根据温度设置风扇档位并输出档位与占空比百分比
  66   2                      {
  67   3                              unsigned char level;
  68   3                              if (T < 25.0)
  69   3                              {
  70   4                                      level = 0;
  71   4                              }
  72   3                              else if (T < 27.0)
  73   3                              {
  74   4                                      level = 1;
  75   4                              }
  76   3                              else if (T < 30.0)
  77   3                              {
  78   4                                      level = 2;
  79   4                              }
  80   3                              else
  81   3                              {
  82   4                                      level = 3;
  83   4                              }
  84   3                              Fan_SetLevel(level);
  85   3      
  86   3                              UART_SendString(" Level:");
  87   3                              UART_SendByte(level + '0');
  88   3                              UART_SendString(" Speed:");
  89   3                              {
  90   4                                      unsigned int sp = Fan_GetDutyPercent(); // 0~100%
  91   4                                      UART_SendByte(sp / 100 % 10 + '0');
  92   4                                      UART_SendByte(sp / 10 % 10 + '0');
  93   4                                      UART_SendByte(sp % 10 + '0');
  94   4                              }
  95   3                              UART_SendByte('%');
  96   3                      }
  97   2      
  98   2                      UART_SendByte('\r');
  99   2                      UART_SendByte('\n');
 100   2                      Delay(1000); // 每次发送后延迟1秒
 101   2              }
 102   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    658    ----
   CONSTANT SIZE    =     44    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      5       3
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
